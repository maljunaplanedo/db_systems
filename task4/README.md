# FoundationDB

База данных FoundationDB создана для обработки транзакций с высокой нагрузкой с высокой производительностью и сильной гарантией (ACID).

Изначально FoundationDB была создана в 2009 году Дэйвом Розенталем, Дэйвом Шерером и Ником Лавеццо. Основатели раньше работали в Visual Sciences, аналитической компании (сейчас является дочерней компанией Adobe). Компания приобрела Akiban в 2013 году. FoundationDB была приобретена Apple в 2015 году. В 2018 году Apple перевела FoundationDB в open-source под лицензией Apache 2.0.

FoundationDB представляет из себя key-value хранилище с отсортированными ключами. Написана она на C++ и C. Для взаимодействия с базой данных можно использовать CLI или API для языков C, Python, Java, Ruby, Go. FoundationDB поддерживает 2 движка (DB engine) - ssd и memory. Первый хранит данные на SSD-диске в виде B-дерева, второй - хранит все данные в памяти и дублирует на диск.
<br/>

Рассмотрим примеры запросов к FoundationDB через CLI. Данные обычно хранят в виде `(subspace, id) => value`, где `subspace` - префикс ключа, необходимый, чтобы разделять разные категории данных (аналог названия таблицы в SQL DB). Посмотрим на примеры запросов:
![CLI-запросы](/task4/images/cli.png)

FoundationDB автоматически равномерно распределяет данные между всеми процессами, которые присоединены к сети, то есть происходит автоматическое решардирование. Это позволяет, например, поднять несколько серверов на одной машине и каждому серверу назначить разные носители. Так, данные окажутся распределены между этими носителями.

В FDB нет отдельного специализированного механизма создания индексов, ведь благодаря устройству этой БД (kv-store с отсортированными ключами) сделать индекс довольно просто. Предположим, какие-то данные хранятся в следующем виде:
`(main_subspace, id) => value`. Хотим добавить индекс по полю `field`. Тогда будем хранить также такие данные: `(index_subspace, field, id) => ''`. Значение пусто, так как оно здесь не требуется, `subspace` другой, чтобы отличить от самих данных. Тогда, например, если нам нужно получить записи, у которых `field == x`, просто сделаем запрос на получение `(index_subspace, field, *)`.

Сгенерируем данные, запишем их в базу, и создадим индекс с помощью Python API. Код можно увидеть в файле `employees.py`.
![Вывод программы на Python API](/task4/images/python.png)

Все процессы в FDB реплицированно хранят определенный диапазон ключей. Таким образом, особо сложного плана запросов тут нет, необходимо пройти по машинам, которые хранят ключи в нужном диапазоне. 

FDB поддерживает ACID-транзакции. Состояние БД версионировано - при чтении считывается та версия БД, которая была выбрана в начале чтения, так можно избежать блокирования - чтение начинается сразу же - и конфликтов с одновременной записью. Эта схема называется Multiversion concurrency control - MVCC. При записи используется Optimistic concurrency control (OCC) - запись неблокирующая, если при записи произошел конфликт, она откатывается. Таким образом, и чтение, и запись неблокирующие.

FDB поддерживает резервное копирование на локальные диски, blob-хранилище, а также резервное копирование в другую FDB - последнее называется Disaster Recovery (DR). Гарантируется, что в резервной БД всегда хранится consistent копия основной. Однако, она синхронизируется не мгновенно, поэтому если основная БД выйдет из строя, то будет утеряно какое-то количество последних изменений.

Над данными в FDB можно построить инфраструктуру Data Mining/DWH/OLAP, однако встроенных инструментов анализа данных/аггрегации нет.

В FDB нет встроенных механизмов авторизации, шифрования трафика, data-at-rest шифрования. Все это необходимо реализовывать в других слоях приложения.

Разработкой FoundationDB занимается компания Apple, не нуждающаяся в представлении, однако исходный код открыт. Для того, чтобы продолжить обучение, ознакомиться с туториалами и документацией - посетите [сайт официальной документации](https://apple.github.io/foundationdb/). Для того, чтобы быть в курсе новых релизов и новостей FoundationDB, заходите в [официальный блог](https://www.foundationdb.org/blog/).
